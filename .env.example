# Environment Configuration Template
# Copy this file to .env and update with your settings

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

# Main database URL for PostgreSQL with asyncpg driver  
# SECURITY: Change the password in production!
DATABASE_URL=postgresql+asyncpg://chatter:CHANGE_THIS_PASSWORD@localhost:5432/chatter

# Database connection pool settings
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=30
DB_POOL_PRE_PING=true
DB_POOL_RECYCLE=3600

# =============================================================================
# VECTOR STORE CONFIGURATION
# =============================================================================

# Vector store type: pgvector, pinecone, qdrant, chromadb
VECTOR_STORE_TYPE=pgvector

# PGVector settings (when using pgvector)
PGVECTOR_COLLECTION_NAME=chatter_embeddings
PGVECTOR_EMBEDDING_DIMENSION=1536

# External vector stores (not currently implemented)
# Uncomment and configure if implementing external vector stores:
# PINECONE_API_KEY=your_pinecone_api_key
# PINECONE_ENVIRONMENT=your_pinecone_environment  
# PINECONE_INDEX_NAME=chatter-index
# QDRANT_URL=http://localhost:6333
# QDRANT_API_KEY=your_qdrant_api_key
# QDRANT_COLLECTION_NAME=chatter
# CHROMADB_PERSIST_DIRECTORY=./data/chromadb
# CHROMADB_COLLECTION_NAME=chatter

# =============================================================================
# CLI CONFIGURATION
# =============================================================================

# CLI client settings
CHATTER_API_BASE_URL=http://localhost:8000
CHATTER_ACCESS_TOKEN=

# =============================================================================
# LLM PROVIDER API KEYS
# =============================================================================

# Note: LLM providers, models, and configurations are now managed through
# the model registry system. Use the admin interface or API endpoints to
# configure providers and models. These API keys are used by the system:

# OpenAI API key
OPENAI_API_KEY=

# Anthropic API key  
ANTHROPIC_API_KEY=

# =============================================================================
# MCP TOOL API KEYS
# =============================================================================

# Brave Search API key (for MCP search tools)
BRAVE_API_KEY=

# =============================================================================
# MODEL REGISTRY CONFIGURATION
# =============================================================================

# Note: LLM providers, models, and configurations are now managed through
# the model registry system. Use the admin interface or API endpoints to
# configure providers and models instead of environment variables.

# =============================================================================
# EMBEDDING DIMENSIONAL REDUCTION SETTINGS
# =============================================================================

# Enable dimensional reduction for embeddings to work around pgvector limits
EMBEDDING_REDUCTION_ENABLED=false

# Target dimensions after reduction (must be <= 2000 for pgvector 0.6.x)
EMBEDDING_REDUCTION_TARGET_DIM=1536

# Reduction strategy: "reducer" (PCA/SVD) or "truncate" (simple truncation)
EMBEDDING_REDUCTION_STRATEGY=truncate

# Path to fitted dimensional reducer (joblib file)
EMBEDDING_REDUCER_PATH=

# Whether to L2-normalize vectors after reduction (recommended for cosine similarity)
EMBEDDING_REDUCTION_NORMALIZE=true

# =============================================================================
# AUTHENTICATION & SECURITY
# =============================================================================

# =============================================================================
# ENCRYPTION & SECURITY CONFIGURATION
# =============================================================================

# Primary encryption key (base64 encoded) - generate with: python -c "import base64, os; print(base64.urlsafe_b64encode(os.urandom(32)).decode())"
# SECURITY: Generate a secure key and change this in production!
CHATTER_ENCRYPTION_KEY=

# Fallback encryption settings (for development only)
CHATTER_SECRET_PASSWORD=default-dev-password
CHATTER_SECRET_SALT=default-dev-salt

# JWT Secret Key (generate with: openssl rand -hex 32)
# SECURITY: Generate a secure key and change this in production!
SECRET_KEY=CHANGE_THIS_SECRET_KEY_IN_PRODUCTION

# JWT Algorithm
ALGORITHM=HS256

# Access token expiration (in minutes)
ACCESS_TOKEN_EXPIRE_MINUTES=30

# Refresh token expiration (in days)
REFRESH_TOKEN_EXPIRE_DAYS=7

# Password hashing settings
BCRYPT_ROUNDS=12

# =============================================================================
# UNIFIED CACHE SYSTEM CONFIGURATION
# =============================================================================

# Cache backend: 'memory', 'redis', 'multi_tier', or 'auto'
CACHE_BACKEND=auto

# Enable/disable Redis caching - if disabled, operations silently fail gracefully
CACHE_ENABLED=true

# Redis URL
REDIS_URL=redis://localhost:6379/0

# Redis connection settings
REDIS_MAX_CONNECTIONS=20
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5
REDIS_CONNECT_TIMEOUT=5
REDIS_CONNECT_RETRIES=3

# Cache TTL settings (in seconds)
CACHE_TTL=3600           # Default cache TTL
CACHE_TTL_SHORT=300      # 5 minutes
CACHE_TTL_MEDIUM=1800    # 30 minutes
CACHE_TTL_LONG=3600      # 1 hour

# Specific cache TTLs
CACHE_MODEL_REGISTRY_TTL=1800  # Model registry cache (30 minutes)
CACHE_WORKFLOW_TTL=3600        # Workflow cache (1 hour)
CACHE_TOOL_TTL=3600           # Tool cache (1 hour)
CACHE_SESSION_TTL=300         # Session cache (5 minutes)

# Memory cache settings
CACHE_MAX_MEMORY_SIZE=1000    # Maximum entries in memory cache
CACHE_L1_SIZE_RATIO=0.1       # L1 cache size ratio for multi-tier
CACHE_EVICTION_POLICY=lru     # Cache eviction policy: 'lru', 'ttl', or 'random'

# =============================================================================
# API CONFIGURATION
# =============================================================================

# =============================================================================
# APPLICATION METADATA
# =============================================================================

# Application settings
APP_NAME=Chatter API
APP_DESCRIPTION=Advanced AI Chatbot Backend API Platform
APP_VERSION=0.1.0

# API Configuration
API_BASE_URL=http://localhost:8000
API_TITLE=Chatter API
API_DESCRIPTION=Advanced AI Chatbot Backend API Platform
API_VERSION=0.1.0
API_PREFIX=/api/v1

# CORS settings
CORS_ORIGINS=["http://localhost:3000", "http://localhost:8080"]
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=["*"]
CORS_ALLOW_HEADERS=["*"]

# =============================================================================
# UNIFIED RATE LIMITING CONFIGURATION
# =============================================================================

# Global rate limiting defaults
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=60

# Use cache backend for distributed rate limiting
RATE_LIMIT_USE_CACHE=true

# Endpoint-specific rate limits
RATE_LIMIT_AUTH_REQUESTS=10
RATE_LIMIT_AUTH_WINDOW=300        # 5 minutes

RATE_LIMIT_ANALYTICS_REQUESTS=20
RATE_LIMIT_ANALYTICS_WINDOW=60

RATE_LIMIT_MODEL_WRITE_REQUESTS=30
RATE_LIMIT_MODEL_WRITE_WINDOW=60

RATE_LIMIT_MODEL_READ_REQUESTS=200
RATE_LIMIT_MODEL_READ_WINDOW=60

# Tool access rate limiting 
RATE_LIMIT_TOOL_HOURLY=100
RATE_LIMIT_TOOL_DAILY=1000

# File upload limits
MAX_FILE_SIZE=50485760    # 50MB in bytes
ALLOWED_FILE_TYPES=["pdf", "txt", "doc", "docx", "md", "html"]

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Enable structured JSON logging
LOG_JSON=false

# Enable debug logging for HTTP requests (WARNING: logs all request/response data)
DEBUG_HTTP_REQUESTS=false

# Enable debug logging for database queries
DEBUG_DATABASE_QUERIES=false

# Enable debug logging for LLM interactions
DEBUG_LLM_INTERACTIONS=false

# Log file path (optional - logs to stdout if not set)
LOG_FILE=

# =============================================================================
# MONITORING & METRICS
# =============================================================================

# Metrics endpoint path
METRICS_PATH=/metrics

# Enable health checks
ENABLE_HEALTH_CHECKS=true

# Health check interval (seconds)
HEALTH_CHECK_INTERVAL=30

# =============================================================================
# DOCUMENT PROCESSING
# =============================================================================

# Document processing settings
CHUNK_SIZE=1000
CHUNK_OVERLAP=200
MAX_CHUNKS_PER_DOCUMENT=1000

# Background processing
ENABLE_BACKGROUND_PROCESSING=true
BACKGROUND_WORKER_CONCURRENCY=4

# Document storage path
DOCUMENT_STORAGE_PATH=./data/documents

# =============================================================================
# LANGCHAIN/LANGGRAPH CONFIGURATION
# =============================================================================

# LangSmith (optional - for tracing and monitoring)
LANGCHAIN_TRACING_V2=false
LANGCHAIN_ENDPOINT=https://api.smith.langchain.com
LANGCHAIN_API_KEY=your_langchain_api_key
LANGCHAIN_PROJECT=chatter

# LangGraph settings
LANGGRAPH_CHECKPOINT_STORE=postgres  # postgres, memory
LANGGRAPH_MAX_ITERATIONS=50
LANGGRAPH_RECURSION_LIMIT=100

# =============================================================================
# WORKFLOW EXECUTION CONFIGURATION
# =============================================================================

# Workflow timeouts (in seconds)
WORKFLOW_EXECUTION_TIMEOUT=300     # 5 minutes
WORKFLOW_STEP_TIMEOUT=60          # 1 minute  
WORKFLOW_STREAMING_TIMEOUT=600    # 10 minutes

# Resource limits
WORKFLOW_MAX_TOKENS=100000
WORKFLOW_MAX_MEMORY_MB=1024
WORKFLOW_MAX_CONCURRENT=10

# Circuit breaker settings
WORKFLOW_FAILURE_THRESHOLD=5
WORKFLOW_CIRCUIT_BREAKER_TIMEOUT=60

# =============================================================================
# STREAMING CONFIGURATION  
# =============================================================================

# Token streaming settings
STREAMING_CHUNK_SIZE=1
STREAMING_HEARTBEAT_INTERVAL=30.0
STREAMING_BUFFER_SIZE=4096

# =============================================================================
# SERVER-SENT EVENTS (SSE) CONFIGURATION
# =============================================================================

# SSE connection settings
SSE_KEEPALIVE_TIMEOUT=30
SSE_MAX_CONNECTIONS_PER_USER=10
SSE_MAX_TOTAL_CONNECTIONS=1000
SSE_CONNECTION_CLEANUP_INTERVAL=300
SSE_INACTIVE_TIMEOUT=3600
SSE_QUEUE_MAXSIZE=100

# =============================================================================
# EMBEDDING PROCESSING
# =============================================================================

# Embedding batch processing
EMBEDDING_BATCH_SIZE=10

# =============================================================================
# MCP (Model Context Protocol) CONFIGURATION
# =============================================================================

# MCP server configuration
MCP_ENABLED=true
MCP_SERVERS=["filesystem", "browser", "calculator"]

# MCP tool timeout (seconds)
MCP_TOOL_TIMEOUT=30

# =============================================================================
# DEVELOPMENT SETTINGS
# =============================================================================

# Development mode
DEBUG=false

# Auto-reload on code changes (development only)
RELOAD=false

# Number of worker processes
WORKERS=1

# Bind host and port
HOST=0.0.0.0
PORT=8000

# =============================================================================
# TESTING CONFIGURATION
# =============================================================================

# Test database URL (used during testing)
# SECURITY: Change the password in production test environment!
TEST_DATABASE_URL=postgresql+asyncpg://chatter:CHANGE_THIS_PASSWORD@localhost:5432/chatter_test

# Test Redis URL
TEST_REDIS_URL=redis://localhost:6379/1

# Skip slow tests
SKIP_SLOW_TESTS=false

# =============================================================================
# PRODUCTION SETTINGS
# =============================================================================

# Environment
ENVIRONMENT=development  # development, staging, production

# Enable SSL redirect in production
FORCE_HTTPS=false

# Trusted hosts (comma-separated)
# In development, host:port combinations are automatically added for convenience
# In production, only these exact hosts are trusted for security
TRUSTED_HOSTS=localhost,127.0.0.1

# Security headers
SECURITY_HEADERS_ENABLED=true

